<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Vue.directive</title>
</head>
<body>

<div id="mount-point"></div>

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script>
    /*
    Vue.directive(option)
    ğŸ™‚ å‚æ•°  
      {string} id
      {Function | Object} [definition]
    ğŸ™‚ ç”¨æ³•
        æ³¨å†Œæˆ–è·å–å…¨å±€æŒ‡ä»¤ã€‚
    ğŸŒ° 
    */
    // æ³¨å†Œ
    Vue.directive('my-directive', {
        bind: function () {},
        inserted: function () {},
        update: function () {},
        componentUpdated: function () {},
        unbind: function () {}
    })

    // æ³¨å†Œ (æŒ‡ä»¤å‡½æ•°)
    Vue.directive('my-directive', function () {
    // è¿™é‡Œå°†ä¼šè¢« `bind` å’Œ `update` è°ƒç”¨
    })

    // getterï¼Œè¿”å›å·²æ³¨å†Œçš„æŒ‡ä»¤
    var myDirective = Vue.directive('my-directive')

    /*
    ğŸ™‚ é™¤äº†é»˜è®¤å†…ç½®çš„æŒ‡ä»¤(v-modelå’Œv-showç­‰), Vueä¹Ÿå…è®¸æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤
    åœ¨ Vue2.0 ä¸­ï¼Œä»£ç å¤ç”¨å’ŒæŠ½è±¡çš„ä¸»è¦å½¢å¼æ˜¯ç»„ä»¶ã€‚
    ç„¶è€Œï¼Œæœ‰çš„æƒ…å†µä¸‹ï¼Œä½ ä»ç„¶éœ€è¦å¯¹æ™®é€š DOM å…ƒç´ è¿›è¡Œåº•å±‚æ“ä½œï¼Œè¿™æ—¶å€™å°±ä¼šç”¨åˆ°è‡ªå®šä¹‰æŒ‡ä»¤
    */
    // é’©å­å‡½æ•°
    Vue.directive('my-directive', {
        bind: function (el, binding, vnode) {
            //åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚åœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®
        },
        inserted: function (el, binding, vnode) {
            //è¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ (ä»…ä¿è¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šå·²è¢«æ’å…¥æ–‡æ¡£ä¸­)
        },
        update: function (el, binding, vnode, oldVnode) {
            //æ‰€åœ¨ç»„ä»¶çš„ VNode æ›´æ–°æ—¶è°ƒç”¨ï¼Œä½†æ˜¯å¯èƒ½å‘ç”Ÿåœ¨å…¶å­ VNode æ›´æ–°ä¹‹å‰ã€‚
            //æŒ‡ä»¤çš„å€¼å¯èƒ½å‘ç”Ÿäº†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚
            //ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒæ›´æ–°å‰åçš„å€¼æ¥å¿½ç•¥ä¸å¿…è¦çš„æ¨¡æ¿æ›´æ–° (è¯¦ç»†çš„é’©å­å‡½æ•°å‚æ•°è§ä¸‹)
        },
        componentUpdated: function (el, binding, vnode, oldVnode) {
            //æŒ‡ä»¤æ‰€åœ¨ç»„ä»¶çš„ VNode åŠå…¶å­ VNode å…¨éƒ¨æ›´æ–°åè°ƒç”¨
        },
        unbind: function (el, binding, vnode, oldVnode) {
            //åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨
        }

        //å›è°ƒå‡½æ•°å‚æ•°
        //ğŸ™‚ el: æŒ‡ä»¤æ‰€ç»‘å®šçš„å…ƒç´ ï¼Œå¯ä»¥ç”¨æ¥ç›´æ¥æ“ä½œ DOM ã€‚

        /*ğŸ™‚ binding: ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š
            name: æŒ‡ä»¤åï¼Œä¸åŒ…æ‹¬ v- å‰ç¼€ã€‚
            value: æŒ‡ä»¤çš„ç»‘å®šå€¼ï¼Œä¾‹å¦‚ï¼šv-my-directive="1 + 1" ä¸­ï¼Œç»‘å®šå€¼ä¸º 2ã€‚
            oldValue: æŒ‡ä»¤ç»‘å®šçš„å‰ä¸€ä¸ªå€¼ï¼Œä»…åœ¨ update å’Œ componentUpdated é’©å­ä¸­å¯ç”¨ã€‚æ— è®ºå€¼æ˜¯å¦æ”¹å˜éƒ½å¯ç”¨ã€‚
            expression: å­—ç¬¦ä¸²å½¢å¼çš„æŒ‡ä»¤è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ v-my-directive="1 + 1" ä¸­ï¼Œè¡¨è¾¾å¼ä¸º "1 + 1"ã€‚
            arg: ä¼ ç»™æŒ‡ä»¤çš„å‚æ•°ï¼Œå¯é€‰ã€‚ä¾‹å¦‚ v-my-directive:foo ä¸­ï¼Œå‚æ•°ä¸º "foo"ã€‚
            modifiers: ä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼šv-my-directive.foo.bar ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡ä¸º { foo: true, bar: true }ã€‚
        */
        
        //ğŸ™‚ vnode: Vueç¼–è¯‘ç”Ÿæˆçš„è™šæ‹ŸèŠ‚ç‚¹, vnodeè¯·ç§»æ­¥(çœ‹ä¸æ‡‚)https://github.com/vuejs/vue/blob/dev/src/core/vdom/vnode.js

        //ğŸ™‚ oldVnode: ä¸Šä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»…åœ¨ update å’Œ componentUpdated é’©å­ä¸­å¯ç”¨ã€‚
    })

    //å®è·µï¼š

        Vue.directive('test', {
            bind(el, binding, vnode) {
                console.log(el)  //<div>0</div>
                console.log(binding)
                console.log(vnode)

            },
            update(el, binding, vnode, oldVnode) {
                console.log(el)
                console.log(binding)
                console.log(vnode)
                console.log(oldVnode)
            }
        });

        new Vue({
            el: '#mount-point',
            data: {
                validOption: {
                    name: {
                        required: true,
                        pattern: /\d/,
                        value: ''
                    }
                }
            },
            template: '<form v-test="change()"><input type="text" name="name" v-model="validOption.name.value"></form>',
            methods: {
                change(name) {
                    return this.validOption[name];
                }
            }
        });
    
    

</script>
</body>
</html>